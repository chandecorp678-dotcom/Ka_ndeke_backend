<!DOCTYPE html>  
<html lang="en">  
<head>  
  <meta charset="UTF-8" />  
  <title>Ka Ndeke ‚Äì Aviator</title>  
  <meta name="viewport" content="width=device-width, initial-scale=1" />  
  
  <style>  
    body {  
      margin: 0;  
      font-family: Arial, sans-serif;  
      background: #081a2b;  
      color: #fff;  
      text-align: center;  
    }  
  
    header {  
      background: #03101f;  
      padding: 10px;  
      display: flex;  
      justify-content: space-between;  
      align-items: center;  
    }  
  
    header h1 {  
      margin: 0;  
      font-size: 18px;  
      color: gold;  
    }  
  
    header button {  
      margin-left: 5px;  
    }  
  
    button {  
      padding: 8px 14px;  
      border-radius: 4px;  
      border: none;  
      cursor: pointer;  
    }  
  
    .primary {  
      background: gold;  
      color: #000;  
      font-weight: bold;  
    }  
  
    .danger {  
      background: crimson;  
      color: #fff;  
    }  
  
    .panel {  
      padding: 10px;  
    }  
  
    .game-box {  
      background: #12345a;  
      margin: 10px;  
      border-radius: 10px;  
      padding: 10px;  
      height: 260px;  
      position: relative;  
      overflow: hidden;  
    }  
  
    #multiplier {  
      font-size: 26px;  
      font-weight: bold;  
      position: absolute;  
      top: 10px;  
      left: 10px;  
    }  
  
    #plane {  
      width: 80px;  
      position: absolute;  
      bottom: 20px;  
      left: 10px;  
      transition: transform 0.05s linear;  
    }  
  
    input {  
      padding: 8px;  
      width: 120px;  
      text-align: center;  
    }  
  
    .controls {  
      margin-top: 10px;  
    }  
  
    .modal {  
      position: fixed;  
      top: 0;  
      left: 0;  
      width: 100%;  
      height: 100%;  
      background: rgba(0,0,0,0.8);  
      display: none;  
      align-items: center;  
      justify-content: center;  
      z-index: 1000;  
    }  
  
    .modal-content {  
      background: #0c223a;  
      padding: 20px;  
      width: 90%;  
      max-width: 300px;  
      border-radius: 8px;  
    }  
  
    .modal-content h3 {  
      margin-top: 0;  
    }  
  
    .modal-content input {  
      width: 100%;  
      margin-bottom: 10px;  
      padding: 8px;  
      color: #fff;  
      background: #0b1b33;  
      border: 1px solid #444;  
      border-radius: 4px;  
    }  
  
    .hidden { display: none; }  
  </style>  
</head>  
<body>  
  
<header>  
  <h1>‚úàÔ∏è Ka Ndeke</h1>  
  <div>  
    <button id="loginBtn" onclick="showLogin()">Login</button>  
    <button id="registerBtn" onclick="showRegister()">Register</button>  
    <button id="logoutBtn" onclick="logout()" class="hidden">Logout</button>  
    <button id="guestBtn" onclick="useGuest()">Guest</button>  
  </div>  
</header>  
  
<div class="panel">  
  <div id="userInfo">  
    Logged in as: <b id="username">Guest</b><br />  
    Balance: <b>ZMW <span id="balance">10.00</span></b>  
  </div>  
</div>  
  
<div class="game-box">  
  <div id="multiplier">1.00x</div>  
  
  <svg id="plane" viewBox="0 0 64 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">  
    <path d="M4 18 C18 18 32 16 46 12 C50 11 54 9 60 8 L58 6 C52 7 48 9 44 10 C30 14 18 16 6 18 Z" fill="#FFD54F"/>  
    <path d="M18 18 L36 10 L40 12 L24 20 Z" fill="#FF7043"/>  
    <path d="M22 20 L38 22 L36 24 L20 22 Z" fill="#FF7043"/>  
    <path d="M6 18 L2 14 L2 18 Z" fill="#FF7043"/>  
    <circle cx="46" cy="11" r="2.2" fill="rgba(0,0,0,0.6)"/>  
    <path d="M4 18 C18 18 32 16 46 12 C50 11 54 9 60 8" fill="none" stroke="rgba(0,0,0,0.06)" stroke-width="1"/>  
  </svg>  
</div>  
  
<div class="controls">  
  <input type="number" id="betAmount" value="5" min="1" />  
  <br /><br />  
  <button class="primary" onclick="startGame()">Play</button>  
  <button class="danger" onclick="cashOut()">Cash Out</button>  
  <br /><br />  
  <button onclick="deposit()">Deposit ZMW</button>  
  <button onclick="withdraw()">Withdraw ZMW</button>  
</div>  
  
<div class="modal" id="loginModal">  
  <div class="modal-content">  
    <h3>Login</h3>  
    <input id="loginPhone" placeholder="Phone number" />  
    <input id="loginPassword" type="password" placeholder="Password" />  
    <button class="primary" onclick="login()">Submit</button>  
    <button onclick="hideModals()">Cancel</button>  
  </div>  
</div>  
  
<div class="modal" id="registerModal">  
  <div class="modal-content">  
    <h3>Register</h3>  
    <input id="regName" placeholder="Full name" />  
    <input id="regPhone" placeholder="Phone number" />  
    <input id="regPassword" type="password" placeholder="Password" />  
    <button class="primary" onclick="register()">Submit</button>  
    <button onclick="hideModals()">Cancel</button>  
  </div>  
</div>  
  
<script>  
const API = "https://ka-ndeke-backend-5dgy.onrender.com/api"; // <-- updated backend  
  
let user = { guest: true };  
let balance = 10;  
let running = false;  
let multiplier = 1;  
let interval;  
let crashPoint = 0;  
  
const loginModal = document.getElementById("loginModal");  
const registerModal = document.getElementById("registerModal");  
const loginBtn = document.getElementById("loginBtn");  
const registerBtn = document.getElementById("registerBtn");  
const logoutBtn = document.getElementById("logoutBtn");  
const guestBtn = document.getElementById("guestBtn");  
  
function updateUI() {  
  document.getElementById("username").textContent =
  user.guest ? "Guest" : user.username;  
  document.getElementById("balance").textContent = balance.toFixed(2);  
  
  if(user.guest) {  
    logoutBtn.classList.add("hidden");  
    loginBtn.classList.remove("hidden");  
    registerBtn.classList.remove("hidden");  
    guestBtn.classList.remove("hidden");  
  } else {  
    logoutBtn.classList.remove("hidden");  
    loginBtn.classList.add("hidden");  
    registerBtn.classList.add("hidden");  
    guestBtn.classList.add("hidden");  
  }  
}  
  
updateUI();  
  
/* GAME LOGIC */  
function startGame() {  
  if (running) return;  
  const bet = Number(betAmount.value);  
  if (bet > balance) return alert("Insufficient balance");  
  
  balance -= bet;  
  updateUI();  
  
  running = true;  
  multiplier = 1;  
  crashPoint = (Math.random() * 4 + 1.2).toFixed(2);  
  
  const planeEl = document.getElementById("plane");  
  
  interval = setInterval(() => {  
    multiplier += 0.01;  
    document.getElementById("multiplier").textContent = multiplier.toFixed(2) + "x";  
    planeEl.style.transform = `translate(${multiplier * 30}px, -${multiplier * 15}px)`;  
  
    if (multiplier >= crashPoint) {  
      endGame(false);  
    }  
  }, 50);  
}  
  
function cashOut() {  
  if (!running) return;  
  endGame(true);  
}  
  
function endGame(win) {  
  clearInterval(interval);  
  running = false;  
  
  if (win) {  
    const winAmount = Number(betAmount.value) * multiplier;  
    balance += winAmount;  
  }  
  
  multiplier = 1;  
  document.getElementById("plane").style.transform = "translate(0,0)";  
  document.getElementById("multiplier").textContent = "1.00x";  
  updateUI();  
}  
  
/* AUTH MODALS */  
function showLogin() { loginModal.style.display = "flex"; }  
function showRegister() { registerModal.style.display = "flex"; }  
function hideModals() {  
  loginModal.style.display = "none";  
  registerModal.style.display = "none";  
}  
  
async function login() {  
  if(!loginPhone.value || !loginPassword.value) return alert("Phone and password required");  
  try {  
    const res = await fetch(API + "/auth/login", {  
      method: "POST",  
      headers: { "Content-Type": "application/json" },  
      body: JSON.stringify({  
        phone: loginPhone.value,  
        password: loginPassword.value  
      })  
    });  
    const data = await res.json();  
    if (!res.ok) throw new Error(data.error || "Login failed");  
  
    localStorage.setItem("token", data.token);          // store JWT token
localStorage.setItem("username", data.user.username); // store username
user = data.user;
balance = Number(data.balance || 5);
hideModals();
updateUI();  
  } catch(err) {  
    alert(err.message);  
  }  
}  
  
async function register() {  
  if(!regName.value || !regPhone.value || !regPassword.value) return alert("Username, phone and password required");  
  try {  
    const res = await fetch(API + "/auth/register", {  
      method: "POST",  
      headers: { "Content-Type": "application/json" },  
      body: JSON.stringify({  
        username: regName.value,  
        phone: regPhone.value,  
        password: regPassword.value  
      })  
    });  
    const data = await res.json();  
    if (!res.ok) throw new Error(data.error || "Register failed");  
  
    localStorage.setItem("token", data.token);          // store JWT token
localStorage.setItem("username", data.user.username); // store username
user = data.user;
balance = 10;
hideModals();
updateUI();  
  } catch(err) {  
    alert(err.message);  
  }  
}  
  
function logout() {  
  user = { guest: true };  
  balance = 10;  
  updateUI();  
}  
  
/* GUEST MODE */  
function useGuest() {  
  user = { guest: true, name: "Guest" };  
  balance = Number(localStorage.getItem("guest_balance") || 10);  
  updateUI();  
}  
  
/* WALLET */  
async function deposit() {
  const amt = prompt("Enter deposit amount");
  if (!amt || isNaN(amt) || amt <= 0) return alert("Invalid amount");

  // üü° GUEST MODE ‚Üí local only
  if (user.guest) {
    balance += Number(amt);
    localStorage.setItem("guest_balance", balance);
    updateUI();
    return;
  }

  // üîµ LOGGED-IN USER ‚Üí backend
  const res = await fetch(API + "/wallet/deposit", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + localStorage.getItem("token")
    },
    body: JSON.stringify({ amount: Number(amt) })
  });

  const data = await res.json();
  if (!res.ok) return alert(data.error || "Deposit failed");

  balance = Number(
  data.balance ??
  data.user?.balance ??
  balance
);
  updateUI();
}  
  
async function withdraw() {
  const amt = prompt("Enter withdraw amount");
  if (!amt || isNaN(amt) || amt <= 0) return alert("Invalid amount");

  // üü° GUEST MODE
  if (user.guest) {
    if (amt > balance) return alert("Insufficient balance");
    balance -= Number(amt);
    localStorage.setItem("guest_balance", balance);
    updateUI();
    return;
  }

  // üîµ LOGGED-IN USER
  const res = await fetch(API + "/wallet/withdraw", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + localStorage.getItem("token")
    },
    body: JSON.stringify({ amount: Number(amt) })
  });

  const data = await res.json();
  if (!res.ok) return alert(data.error || "Withdraw failed");

  balance = Number(
  data.balance ??
  data.user?.balance ??
  balance
);
  updateUI();
}  
</script>  
  
</body>  
      </html> 
